<!-- Assignment filter -->
<div class="input-field">
  <input id="assignmentFilter" type="text" [(ngModel)]="assignmentFilter">
  <label for="assignmentFilter">Nombre de la actividad</label>
</div>

<!-- Assignmnets body -->
<ul materialize="collapsible" *ngIf="assignments && (assignments | filter: assignmentFilter).length != 0" class="collapsible" data-collapsible="expandable">
  <li *ngFor="let assignment of assignments | filter: assignmentFilter">
    <div class="collapsible-header">
      <i class="material-icons">assignment</i>{{ assignment.name }}
    </div>

    <div class="collapsible-body">
      <!-- File name -->
      <div class="row">
        <div class="input-field">
          <i class="material-icons prefix">description</i>
          <input id="assignmentName" type="text" [(ngModel)]="assignment.name" [value]="assignment.name">
          <label for="assignmentName">Nombre de la actividad</label>
        </div>
      </div>
      
      <!-- File turned in and date -->
      <div class="row">
          <!-- File turned in -->
        <div class="col s6">
          <div class="input-field">
            <a [href]="assignment.file.fileURL" target="_blank" class="material-icons prefix file-download">
              <span
              materialize="tooltip"
              class=" tooltiped"
              data-position="bottom"
              data-delay="30"
              data-tooltip="Da click para descargar archivo">attachment</span>
            </a>
            
            <input
              disabled
              id="fileSubmited"
              type="text"
              [value]="assignment.file.fileName">
            <label for="fileSubmited">Archivo entregado</label>
          </div>
        </div>

        <!-- Date -->
        <div class="col s6">
          <div class="input-field">
            <i class="material-icons prefix">date_range</i>
            <input
              materialize="pickadate"
              class="datepicker"
              id="assignmentDate"
              type="text"
              [materializeParams]="[{format: 'dd/mm/yyyy'}]"
              [(ngModel)]="assignment.date"
              placeholder="Fecha de entrega">
              <label for="assignmentDate">Fecha entragada</label>
          </div>
        </div>
      </div>

      <!-- Feedback -->
      <div class="row">
        <div class="input-field">
          <i class="material-icons prefix">question_answer</i>
          <textarea id="textarea1" class="materialize-textarea" [value]="assignment.feedback" [(ngModel)]="assignment.feedback">{{ assignment.feedback }}</textarea>
          <label for="textarea1">Retroalimentación</label>
        </div>
      </div>

      <!-- Grade and incidents -->
      <div class="row">
        <!-- Grade -->
        <div class="col s6">
          <div class="input-field">
            <i class="material-icons prefix">assignment_turned_in</i>
            <input
              id="grade"
              type="number"
              [value]="assignment.grade"
              [(ngModel)]="assignment.grade"
              min="0"
              max="100">
            <label for="grade">Calificación</label>
          </div>
        </div>
        <!-- Incidents -->
        <div class="col s6">
          <div class="input-field">
            <i 
              class="material-icons prefix tooltiped"
              materialize="tooltip"
              data-position="top"
              data-delay="30"
              data-tooltip="Incidencias">
            assignment_late</i>
            <div
              materialize="material_chip"
              (chip.add)="addIncident($event.detail, assignment)"
              (chip.delete)="removeIncident($event.detail, assignment)"
              [materializeParams]="[assignment]"
              id="incidents"
              class="chips">
            </div>
          </div>
        </div>
      </div>

      <button class="waves-effect waves-light blue darken-3 btn" (click)="updateAssignment(assignment)">guardar cambios</button>
      <button class="waves-effect waves-light red darken-3 btn right" (click)="deleteAssignment(assignment)">eliminar actividad</button>
    </div>
  </li>
</ul>

<div *ngIf="assignments && (assignments | filter: assignmentFilter).length == 0" class="new-activity-form">
  <div class="row">
    <div class="col s6">
      <div class="file-field input-field">
        <div class="waves-effect waves-light orange darken-3 btn">
          archivo de la actividad
          <input type="file" (change)="setAssignmentFile($event)">
        </div>
        <div class="file-path-wrapper">
          <input class="file-path validate" type="text">
        </div>
      </div>
    </div>

    <div class="col s6">
      <div class="input-field">
        <i class="material-icons prefix">date_range</i>
        <input
          materialize="pickadate"
          class="datepicker"
          type="text"
          [(ngModel)]="newAssignment.date"
          placeholder="Fecha de entrega">
      </div>
    </div>
  </div>

  <button
    [class.disabled]="newAssignmentFile == null || !newAssignment.date || !assignmentFilter"
    class="waves-effect waves-light blue darken-3 btn" (click)="addAssignment()">
  agregar nueva actividad
  </button>
</div>